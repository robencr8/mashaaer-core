<!DOCTYPE html>
<html>
<head>
    <title>CORS Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f5f5f5;
            white-space: pre-wrap;
        }
        button {
            padding: 10px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>CORS Test Page</h1>
    <p>This page tests CORS configuration for the Mashaaer API.</p>
    
    <div>
        <h2>Test Endpoints</h2>
        <button id="testHealth">Test /health</button>
        <button id="testApiStatus">Test /api/status</button>
        <button id="testAll">Test All Endpoints</button>
    </div>
    
    <div>
        <h3>Results:</h3>
        <div id="results" class="result">Results will appear here...</div>
    </div>
    
    <script>
        const resultDiv = document.getElementById('results');
        const baseUrl = window.location.origin; // Get the current origin
        
        function addResult(message) {
            resultDiv.innerHTML += message + '\n';
        }
        
        function clearResults() {
            resultDiv.innerHTML = '';
        }
        
        async function testEndpoint(url, name) {
            try {
                addResult(`Testing ${name} (${url})...`);
                console.log(`Fetching ${url}`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    credentials: 'include'
                });
                
                addResult(`Status: ${response.status} ${response.statusText}`);
                
                // Log all headers
                addResult('Response headers:');
                response.headers.forEach((value, key) => {
                    addResult(`  ${key}: ${value}`);
                });
                
                if (response.headers.get('content-type')?.includes('application/json')) {
                    const data = await response.json();
                    addResult(`Response data: ${JSON.stringify(data, null, 2)}`);
                } else {
                    const text = await response.text();
                    addResult(`Response text: ${text.substring(0, 150)}...`);
                }
                
                addResult('Test completed successfully');
                return true;
            } catch (error) {
                addResult(`Error testing ${name}: ${error.message}`);
                console.error('Error:', error);
                return false;
            }
        }
        
        document.getElementById('testHealth').addEventListener('click', async () => {
            clearResults();
            await testEndpoint(`${baseUrl}/health`, 'Health Endpoint');
        });
        
        document.getElementById('testApiStatus').addEventListener('click', async () => {
            clearResults();
            await testEndpoint(`${baseUrl}/api/status`, 'API Status Endpoint');
        });
        
        document.getElementById('testAll').addEventListener('click', async () => {
            clearResults();
            addResult('=== Testing All Endpoints ===');
            await testEndpoint(`${baseUrl}/health`, 'Health Endpoint');
            addResult('---');
            await testEndpoint(`${baseUrl}/api/status`, 'API Status Endpoint');
            addResult('=== All Tests Completed ===');
        });
        
        // Log browser details for debugging
        addResult(`Browser: ${navigator.userAgent}`);
        addResult(`Current origin: ${baseUrl}`);
    </script>
</body>
</html>
