<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Recognition API Test</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .test-container {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            min-height: 100px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            margin-right: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
            border: 1px solid #e9ecef;
        }
        .progress-bar {
            background-color: #e9ecef;
            height: 10px;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress {
            background-color: #3498db;
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .logs {
            margin-top: 20px;
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }
        .toggle-section {
            cursor: pointer;
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .toggle-content {
            display: none;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .active .toggle-content {
            display: block;
        }
        .toggle-section::after {
            content: ' ▼';
            float: right;
        }
        .toggle-section.active::after {
            content: ' ▲';
        }
        .request-badges {
            margin-top: 10px;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 30px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .badge-primary {
            background-color: #3498db;
            color: white;
        }
        .badge-secondary {
            background-color: #95a5a6;
            color: white;
        }
        .badge-success {
            background-color: #2ecc71;
            color: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .test-status {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .status-badge {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-red {
            background-color: #e74c3c;
        }
        .status-green {
            background-color: #2ecc71;
        }
        .status-yellow {
            background-color: #f39c12;
        }
    </style>
</head>
<body>
    <h1>Voice Recognition API Test</h1>
    <p>This tool tests the voice recognition API endpoint with various configurations.</p>

    <div class="test-container">
        <h2>Test Configuration</h2>
        <div class="form-group">
            <label for="endpoint">API Endpoint:</label>
            <input type="text" id="endpoint" value="/api/listen-for-voice" />
        </div>
        <div class="form-group">
            <label for="step">Onboarding Step:</label>
            <select id="step">
                <option value="name">Name</option>
                <option value="full-name">Full Name</option>
                <option value="nickname">Nickname</option>
                <option value="terms-agree">Terms Agreement</option>
                <option value="language">Language Preference</option>
                <option value="voice-style">Voice Style</option>
            </select>
        </div>
        <div class="form-group">
            <label for="method">Request Method:</label>
            <select id="method">
                <option value="POST">POST</option>
                <option value="GET">GET</option>
            </select>
        </div>
        <div class="form-group">
            <label for="content-type">Content Type:</label>
            <select id="content-type">
                <option value="form">multipart/form-data</option>
                <option value="json">application/json</option>
                <option value="text">text/plain</option>
                <option value="none">No Content-Type</option>
            </select>
        </div>
        <div class="form-group">
            <label>Custom Headers:</label>
            <div>
                <input type="checkbox" id="header-origin" checked />
                <label for="header-origin" style="display: inline;">Origin</label>
            </div>
            <div>
                <input type="checkbox" id="header-requested-with" checked />
                <label for="header-requested-with" style="display: inline;">X-Requested-With</label>
            </div>
            <div>
                <input type="checkbox" id="header-accept" checked />
                <label for="header-accept" style="display: inline;">Accept</label>
            </div>
            <div>
                <input type="checkbox" id="header-credentials" checked />
                <label for="header-credentials" style="display: inline;">Include Credentials</label>
            </div>
        </div>
        
        <button onclick="testVoiceRecognition()">Test Voice Recognition</button>
        <button onclick="runBatchTests()">Run All Tests</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <div class="test-container">
        <div class="toggle-section" onclick="toggleSection(this)">
            <h2>Test Result</h2>
        </div>
        <div class="toggle-content active">
            <div class="test-status">
                <div id="test-status-indicator" class="status-badge"></div>
                <span id="test-status-text">Not tested yet</span>
            </div>
            <div id="result" class="test-result info">
                <p>Test results will appear here.</p>
            </div>
        </div>
    </div>

    <div class="test-container">
        <div class="toggle-section" onclick="toggleSection(this)">
            <h2>Request Details</h2>
        </div>
        <div class="toggle-content">
            <div class="request-badges" id="request-badges"></div>
            <table>
                <tr>
                    <th>Property</th>
                    <th>Value</th>
                </tr>
                <tbody id="request-details">
                    <tr>
                        <td colspan="2">No request has been made yet.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="test-container">
        <div class="toggle-section" onclick="toggleSection(this)">
            <h2>Response Headers</h2>
        </div>
        <div class="toggle-content">
            <pre id="response-headers">No response headers yet.</pre>
        </div>
    </div>

    <div class="test-container">
        <div class="toggle-section" onclick="toggleSection(this)">
            <h2>Response Body</h2>
        </div>
        <div class="toggle-content">
            <pre id="response-body">No response body yet.</pre>
        </div>
    </div>

    <div class="test-container">
        <div class="toggle-section" onclick="toggleSection(this)">
            <h2>Test Logs</h2>
        </div>
        <div class="toggle-content active">
            <div class="logs" id="logs"></div>
        </div>
    </div>

    <script>
        // Add a log entry
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logs');
            const timestamp = new Date().toISOString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<span class="log-time">[${timestamp}]</span> <span class="log-text">${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`${type.toUpperCase()}: ${message}`);
        }

        // Clear logs
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            log('Logs cleared');
        }

        // Toggle sections
        function toggleSection(element) {
            element.classList.toggle('active');
            const content = element.nextElementSibling;
            content.classList.toggle('active');
        }

        // Update test status indicator
        function updateTestStatus(status, message) {
            const indicator = document.getElementById('test-status-indicator');
            const text = document.getElementById('test-status-text');
            
            indicator.className = 'status-badge';
            if (status === 'success') {
                indicator.classList.add('status-green');
                text.textContent = message || 'Success';
            } else if (status === 'error') {
                indicator.classList.add('status-red');
                text.textContent = message || 'Error';
            } else if (status === 'warning') {
                indicator.classList.add('status-yellow');
                text.textContent = message || 'Warning';
            } else {
                text.textContent = message || 'Unknown';
            }
        }

        // Display request details
        function displayRequestDetails(options) {
            const badgesContainer = document.getElementById('request-badges');
            const detailsTable = document.getElementById('request-details');
            
            // Clear existing content
            badgesContainer.innerHTML = '';
            detailsTable.innerHTML = '';
            
            // Add badges
            const methodBadge = document.createElement('span');
            methodBadge.className = 'badge badge-primary';
            methodBadge.textContent = options.method;
            badgesContainer.appendChild(methodBadge);
            
            if (options.contentType) {
                const contentBadge = document.createElement('span');
                contentBadge.className = 'badge badge-secondary';
                contentBadge.textContent = options.contentType;
                badgesContainer.appendChild(contentBadge);
            }
            
            if (options.credentials === 'include') {
                const credentialsBadge = document.createElement('span');
                credentialsBadge.className = 'badge badge-success';
                credentialsBadge.textContent = 'With Credentials';
                badgesContainer.appendChild(credentialsBadge);
            }
            
            // Add table rows for request details
            const addRow = (property, value) => {
                const tr = document.createElement('tr');
                const tdProperty = document.createElement('td');
                const tdValue = document.createElement('td');
                
                tdProperty.textContent = property;
                tdValue.textContent = typeof value === 'object' ? JSON.stringify(value) : value;
                
                tr.appendChild(tdProperty);
                tr.appendChild(tdValue);
                detailsTable.appendChild(tr);
            };
            
            addRow('URL', options.url);
            addRow('Method', options.method);
            
            if (options.headers) {
                addRow('Headers', options.headers);
            }
            
            if (options.body) {
                addRow('Body', options.body);
            }
            
            if (options.params) {
                addRow('Query Parameters', options.params);
            }
            
            addRow('Credentials', options.credentials || 'same-origin');
            
            // Make this section active
            const requestSection = document.querySelector('.test-container:nth-child(3) .toggle-section');
            if (!requestSection.classList.contains('active')) {
                toggleSection(requestSection);
            }
        }

        // Make a request to the voice recognition API
        async function testVoiceRecognition() {
            const endpoint = document.getElementById('endpoint').value;
            const step = document.getElementById('step').value;
            const method = document.getElementById('method').value;
            const contentTypeOption = document.getElementById('content-type').value;
            
            // Custom headers
            const includeOrigin = document.getElementById('header-origin').checked;
            const includeRequestedWith = document.getElementById('header-requested-with').checked;
            const includeAccept = document.getElementById('header-accept').checked;
            const includeCredentials = document.getElementById('header-credentials').checked;
            
            // Prepare result area
            const resultElement = document.getElementById('result');
            const headersElement = document.getElementById('response-headers');
            const bodyElement = document.getElementById('response-body');
            
            resultElement.className = 'test-result info';
            resultElement.innerHTML = '<p>Testing voice recognition API...</p>';
            headersElement.textContent = 'Fetching response headers...';
            bodyElement.textContent = 'Fetching response body...';
            
            // Create request options
            const options = {
                method: method,
                headers: {},
                credentials: includeCredentials ? 'include' : 'same-origin'
            };
            
            // Add appropriate headers based on content type
            if (contentTypeOption !== 'none') {
                if (contentTypeOption === 'json') {
                    options.headers['Content-Type'] = 'application/json';
                } else if (contentTypeOption === 'text') {
                    options.headers['Content-Type'] = 'text/plain';
                }
                // For form, the fetch API sets the content type automatically with FormData
            }
            
            if (includeOrigin) {
                options.headers['Origin'] = window.location.origin;
            }
            
            if (includeRequestedWith) {
                options.headers['X-Requested-With'] = 'XMLHttpRequest';
            }
            
            if (includeAccept) {
                options.headers['Accept'] = 'application/json';
            }
            
            // Prepare body data based on method and content type
            let url = endpoint;
            if (method === 'POST') {
                if (contentTypeOption === 'form') {
                    const formData = new FormData();
                    formData.append('step', step);
                    options.body = formData;
                } else if (contentTypeOption === 'json') {
                    options.body = JSON.stringify({ step: step });
                } else if (contentTypeOption === 'text') {
                    options.body = `step=${step}`;
                }
            } else {
                // For GET requests, append parameters to URL
                url += `?step=${encodeURIComponent(step)}`;
            }
            
            // Log request details
            log(`Making ${method} request to ${url}`, 'info');
            log(`Headers: ${JSON.stringify(options.headers)}`, 'info');
            if (options.body) {
                if (options.body instanceof FormData) {
                    log(`Body: FormData with step=${step}`, 'info');
                } else {
                    log(`Body: ${options.body}`, 'info');
                }
            }
            
            // Display request details in UI
            displayRequestDetails({
                url: url,
                method: method,
                headers: options.headers,
                body: options.body instanceof FormData ? 'FormData with step=' + step : options.body,
                params: method === 'GET' ? { step: step } : null,
                contentType: contentTypeOption,
                credentials: options.credentials
            });
            
            try {
                // Make the request
                const startTime = performance.now();
                const response = await fetch(url, options);
                const endTime = performance.now();
                const responseTime = (endTime - startTime).toFixed(2);
                
                // Get response headers
                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                });
                
                // Display response headers
                headersElement.textContent = JSON.stringify(headers, null, 2);
                
                // Make headers section active
                const headersSection = document.querySelector('.test-container:nth-child(4) .toggle-section');
                if (!headersSection.classList.contains('active')) {
                    toggleSection(headersSection);
                }
                
                // Parse response body
                let responseBody;
                let responseText;
                
                try {
                    responseBody = await response.json();
                    responseText = JSON.stringify(responseBody, null, 2);
                } catch (jsonError) {
                    responseText = await response.text();
                    log(`Error parsing JSON response: ${jsonError.message}`, 'error');
                }
                
                // Display response body
                bodyElement.textContent = responseText;
                
                // Make body section active
                const bodySection = document.querySelector('.test-container:nth-child(5) .toggle-section');
                if (!bodySection.classList.contains('active')) {
                    toggleSection(bodySection);
                }
                
                // Check response status
                if (response.ok) {
                    if (responseBody && responseBody.success) {
                        resultElement.className = 'test-result success';
                        resultElement.innerHTML = `
                            <p>Voice recognition API test successful!</p>
                            <p>Response time: ${responseTime}ms</p>
                            <p>Status: ${response.status} ${response.statusText}</p>
                            <p>Recognized text: <strong>${responseBody.text}</strong></p>
                            <p>Confidence: ${responseBody.confidence}</p>
                            <p>Step: ${responseBody.step || step}</p>
                        `;
                        updateTestStatus('success', `Success (${responseTime}ms)`);
                        log(`Voice recognition test successful: "${responseBody.text}" (${responseTime}ms)`, 'info');
                    } else {
                        resultElement.className = 'test-result error';
                        resultElement.innerHTML = `
                            <p>Voice recognition API returned success status but reported an error in the response body.</p>
                            <p>Response time: ${responseTime}ms</p>
                            <p>Status: ${response.status} ${response.statusText}</p>
                            <p>Error: ${responseBody && responseBody.error ? responseBody.error : 'Unknown error'}</p>
                        `;
                        updateTestStatus('error', 'API Error');
                        log(`Voice recognition API error: ${responseBody && responseBody.error ? responseBody.error : 'Unknown error'}`, 'error');
                    }
                } else {
                    resultElement.className = 'test-result error';
                    resultElement.innerHTML = `
                        <p>Voice recognition API test failed!</p>
                        <p>Response time: ${responseTime}ms</p>
                        <p>Status: ${response.status} ${response.statusText}</p>
                        <p>Error: ${responseBody && responseBody.error ? responseBody.error : 'Unknown error'}</p>
                    `;
                    updateTestStatus('error', `Error ${response.status}`);
                    log(`Voice recognition test failed: ${response.status} ${response.statusText} (${responseTime}ms)`, 'error');
                }
            } catch (error) {
                resultElement.className = 'test-result error';
                resultElement.innerHTML = `
                    <p>Voice recognition API test error!</p>
                    <p>Error: ${error.message}</p>
                `;
                headersElement.textContent = 'No response headers available due to error.';
                bodyElement.textContent = 'No response body available due to error.';
                updateTestStatus('error', 'Connection Error');
                log(`Voice recognition test error: ${error.message}`, 'error');
            }
        }

        // Run a batch of tests with different configurations
        async function runBatchTests() {
            log('Starting batch tests...', 'info');
            
            const resultElement = document.getElementById('result');
            resultElement.className = 'test-result info';
            resultElement.innerHTML = '<p>Running batch tests...</p><div class="progress-bar"><div id="progress" class="progress"></div></div>';
            
            const progressBar = document.getElementById('progress');
            
            const tests = [
                { method: 'POST', contentType: 'form', step: 'name', withCredentials: true },
                { method: 'POST', contentType: 'json', step: 'full-name', withCredentials: true },
                { method: 'GET', contentType: 'none', step: 'terms-agree', withCredentials: true },
                { method: 'POST', contentType: 'form', step: 'nickname', withCredentials: false }
            ];
            
            const results = [];
            
            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                
                // Update progress
                progressBar.style.width = `${((i + 1) / tests.length) * 100}%`;
                
                // Set form fields to match test
                document.getElementById('method').value = test.method;
                document.getElementById('content-type').value = test.contentType;
                document.getElementById('step').value = test.step;
                document.getElementById('header-credentials').checked = test.withCredentials;
                
                // Run the test
                log(`Running test ${i + 1}/${tests.length}: ${test.method} with ${test.contentType}, step=${test.step}`, 'info');
                
                // Short delay to allow UI to update
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Make the test
                try {
                    await testVoiceRecognition();
                    results.push({
                        test: test,
                        success: document.getElementById('test-status-indicator').classList.contains('status-green')
                    });
                } catch (error) {
                    log(`Error running test ${i + 1}: ${error.message}`, 'error');
                    results.push({
                        test: test,
                        success: false,
                        error: error.message
                    });
                }
                
                // Short delay between tests
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            // Display batch test results
            const successCount = results.filter(r => r.success).length;
            
            resultElement.className = 'test-result info';
            resultElement.innerHTML = `
                <h3>Batch Test Results</h3>
                <p>${successCount}/${tests.length} tests passed</p>
                <table>
                    <tr>
                        <th>Test</th>
                        <th>Method</th>
                        <th>Content Type</th>
                        <th>Step</th>
                        <th>Credentials</th>
                        <th>Result</th>
                    </tr>
                    ${results.map((result, index) => `
                        <tr>
                            <td>Test ${index + 1}</td>
                            <td>${result.test.method}</td>
                            <td>${result.test.contentType}</td>
                            <td>${result.test.step}</td>
                            <td>${result.test.withCredentials ? 'Yes' : 'No'}</td>
                            <td>${result.success ? 
                                '<span style="color: #2ecc71;">✓ Pass</span>' : 
                                '<span style="color: #e74c3c;">✗ Fail</span>'}</td>
                        </tr>
                    `).join('')}
                </table>
            `;
            
            log(`Batch tests completed: ${successCount}/${tests.length} passed`, 'info');
            
            if (successCount === tests.length) {
                updateTestStatus('success', 'All Tests Passed');
            } else if (successCount > 0) {
                updateTestStatus('warning', `${successCount}/${tests.length} Passed`);
            } else {
                updateTestStatus('error', 'All Tests Failed');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('Voice recognition API test tool initialized', 'info');
            
            // Make certain sections active by default
            document.querySelector('.test-container:nth-child(1) .toggle-section').nextElementSibling.classList.add('active');
            document.querySelector('.test-container:nth-child(2) .toggle-section').nextElementSibling.classList.add('active');
            document.querySelector('.test-container:nth-child(6) .toggle-section').nextElementSibling.classList.add('active');
        });
    </script>
</body>
</html>