<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback Tool Whitelist Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #7743DB;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Feedback Tool Whitelist Test</h1>
    <p>This page attempts to connect to various whitelisted origins to check connectivity.</p>
    
    <div>
        <h2>Your Connection Details</h2>
        <pre id="connection-info">Loading...</pre>
    </div>
    
    <div>
        <h2>CORS Test</h2>
        <pre id="cors-test">Loading...</pre>
    </div>
    
    <script>
        // Display connection information
        function showConnectionInfo() {
            const info = {
                'URL': window.location.href,
                'Origin': window.location.origin,
                'Host': window.location.host,
                'Protocol': window.location.protocol,
                'Pathname': window.location.pathname,
                'User Agent': navigator.userAgent,
                'Platform': navigator.platform,
                'Online': navigator.onLine
            };
            
            let text = '';
            for (const [key, value] of Object.entries(info)) {
                text += `${key}: ${value}\n`;
            }
            
            document.getElementById('connection-info').textContent = text;
        }
        
        // Test CORS by accessing known endpoints
        async function testCORS() {
            const endpoints = [
                '/health',
                '/ultra-simple',
                '/api/minimal',
                '/feedback-tool-test'
            ];
            
            let results = '';
            
            try {
                for (const endpoint of endpoints) {
                    try {
                        const startTime = performance.now();
                        const response = await fetch(endpoint);
                        const endTime = performance.now();
                        const responseTime = (endTime - startTime).toFixed(2);
                        
                        let text = '';
                        try {
                            text = await response.text();
                        } catch (e) {
                            text = '[Error reading response text]';
                        }
                        
                        results += `✅ ${endpoint}\n`;
                        results += `  Status: ${response.status} ${response.statusText}\n`;
                        results += `  Time: ${responseTime}ms\n`;
                        results += `  Response: ${text.substring(0, 100)}${text.length > 100 ? '...' : ''}\n\n`;
                        
                        // Display headers
                        results += '  Headers received:\n';
                        response.headers.forEach((value, key) => {
                            results += `    ${key}: ${value}\n`;
                        });
                        results += '\n';
                        
                    } catch (error) {
                        results += `❌ ${endpoint}\n`;
                        results += `  Error: ${error.message}\n\n`;
                    }
                }
            } catch (error) {
                results = `Error running tests: ${error.message}`;
            }
            
            document.getElementById('cors-test').textContent = results;
        }
        
        // Run tests on page load
        window.onload = function() {
            showConnectionInfo();
            testCORS();
        };
    </script>
</body>
</html>
